<!DOCTYPE html>
<html>
	<head>
		<title>Health Metrics</title>
		<script
			src="https://unpkg.com/htmx.org@1.9.11"
			integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0"
			crossorigin="anonymous"
		></script>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="./style.css" />
	</head>
	<body>
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-6">
					<div id="message" class="alert alert-info mt-3" style="display: none">
						<div class="form-check">
							<input
								type="checkbox"
								class="form-check-input"
								id="useProfileData"
								checked
							/>
							<label class="form-check-label" for="useProfileData"
								>Use your health metrics profile</label
							>
						</div>
					</div>
					<form
						hx-post="/calculaterequiredcalories"
						hx-trigger="submit"
						hx-target="#result"
						hx-swap-oob="true"
						hx-vals='javascript:{ "weightChange": document.getElementById("weightChange").value * document.getElementById("weightChangeSign").value, "timeFrame": document.getElementById("timeFrame").value, "maintenanceCalories": document.getElementById("maintenanceCalories").value, "gender": document.querySelector("input[name=gender]:checked").value }'
						class="mt-5"
					>
						<div class="input-group mb-3">
							<select id="weightChangeSign" class="form-control">
								<option selected value="1">+</option>
								<option value="-1">-</option>
							</select>
							<input
								type="number"
								id="weightChange"
								name="weightChange"
								class="form-control"
								required
							/>
						</div>

						<div class="mb-3">
							<label for="timeFrame" class="form-label"
								>Time Frame (in days):</label
							>
							<input
								type="number"
								id="timeFrame"
								name="timeFrame"
								class="form-control"
								required
							/>
						</div>

						<div class="mb-3">
							<label for="maintenanceCalories" class="form-label"
								>Maintenance Calories:</label
							>
							<input
								type="number"
								id="maintenanceCalories"
								name="maintenanceCalories"
								class="form-control"
								required
							/>
						</div>

						<div class="mb-3">
							<label class="form-label">Gender:</label>
							<div class="form-check">
								<input
									class="form-check-input"
									type="radio"
									name="gender"
									id="male"
									value="male"
									checked
								/>
								<label class="form-check-label" for="male">Male</label>
							</div>
							<div class="form-check">
								<input
									class="form-check-input"
									type="radio"
									name="gender"
									id="female"
									value="female"
								/>
								<label class="form-check-label" for="female">Female</label>
							</div>
						</div>

						<button type="submit" class="btn btn-primary">Calculate</button>
					</form>
					<div id="result" class="mt-4"></div>
				</div>
			</div>
		</div>
		<script>
			window.onload = function () {
				const storedData = localStorage.getItem("healthMetricsData");
				if (storedData) {
					const data = JSON.parse(storedData);

					document.getElementById("maintenanceCalories").value =
						data.maintenanceCalories.toFixed(2);
					document.querySelector(
						`input[name="gender"][value="${data.gender}"]`
					).checked = true;

					const messageDiv = document.getElementById("message");
					messageDiv.style.display = "block";

					document.getElementById("useProfileData").checked = true;
				}
			};

			document
				.getElementById("useProfileData")
				.addEventListener("change", function () {
					const storedData = localStorage.getItem("healthMetricsData");
					if (storedData) {
						const data = JSON.parse(storedData);

						if (this.checked) {
							// Refill the form fields with the stored data
							document.getElementById("maintenanceCalories").value =
								data.maintenanceCalories.toFixed(2);
							document.querySelector(
								`input[name="gender"][value="${data.gender}"]`
							).checked = true;
							// Refill other form fields...
						} else {
							// Clear the form fields
							document.getElementById("maintenanceCalories").value = "";
							document.querySelector(
								`input[name="gender"]:checked`
							).checked = false;
							// Clear other form fields...
						}
					}
				});

			document.addEventListener("htmx:afterOnLoad", function (event) {
				var data = event.detail.xhr.response;
				var json = JSON.parse(data);
				var html = `<p>Required Daily Calories: ${json.requiredDailyCalories.toFixed(
					2
				)} kcal</p>`;
				document.getElementById("result").innerHTML = html;
			});
		</script>
	</body>
</html>
